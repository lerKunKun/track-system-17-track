# 17Track 物流监控系统 PRD

## 背景
跨境店铺（Shopify/Shopline/TikTok Shop）需要集中管理多店铺订单的物流状态。17TRACK 提供追踪接口和 Webhook，本系统需支持批量导入运单、持续同步并在异常时提供提醒和重试。

## 目标与范围
- 集中管理多平台店铺的物流追踪，支持批量导入/删除运单。
- 监听 17TRACK Webhook，实时刷新轨迹与状态。
- 提供登录鉴权，确保后台仅授权人员可访问。
- 提供前台运单列表、详情（含轨迹时间线）展示和分页查询。
- 支持 CSV 导入、单号手动创建，并与店铺订单关联。
- 提供店铺/API 接入配置界面：录入并加密存储各平台与 17TRACK 的凭证，支持有效性校验。
- 保障数据持久化（MySQL）、缓存加速（Redis）、消息队列异步处理和失败重试。

不在范围：
- 轨迹地图可视化（MVP 仅时间线）。
- 店铺授权 UI 的 OAuth 流程细节（预留 API）。

## 用户画像
- 运营人员：管理店铺、批量导入运单、查看异常与送达状态。
- 客服人员：查询单号轨迹，回应客户咨询。
- 开发/运维：维护 Webhook、同步任务与告警。

## 核心场景
1. 运营导入 CSV → 系统批量创建 tracking 并入队同步 → 17TRACK 拉取状态 → 列表可查。
2. Webhook 到达 → 校验签名 → 写入日志 → 更新 tracking 状态与轨迹 → 通知前端刷新。
3. 定时或队列重试失败同步 → 标记 sync job 状态 → 运营在后台查看失败原因。
4. 管理员登录 → 进入后台 → 管理店铺信息及 17TRACK/平台 API 凭证 → 启用/禁用店铺同步。

## 功能需求
- 登录鉴权：账户密码登录（MVP 可固定账号），登录态存储 Token；登出与会话过期处理。
- 店铺管理：创建/编辑/禁用店铺，存储 API 凭证，支持多平台标识。
- API 接入配置：
  - 为 17TRACK 与各平台（Shopify/Shopline/TikTok Shop）录入 API Key/Secret/Access Token。
  - 提供「测试连接」以校验凭证有效性，并提示失败原因。
  - 凭证加密存储、脱敏展示，支持更新与吊销。
- 订单管理：按店铺同步/导入订单，关联包裹与物流单号。
- 运单管理：
  - 创建/批量导入/批量删除追踪单号（来源：Shopify、手动、API）。
  - 列表分页、按店铺/状态/更新时间筛选，支持模糊搜索 tracking number。
  - 详情页：基础信息、最近状态、轨迹时间线（倒序）。
- 轨迹同步：
  - 主动拉取：根据 next_sync_at 调度，调用 17TRACK 查询。
  - 被动推送：接收 Webhook，去重、幂等更新。
  - 异常重试：请求失败或解析失败入队重试，记录 sync_jobs。
- CSV 导入：模板校验（必填店铺、单号、承运商），支持预览、错误行报告，导入后异步创建。
- Webhook：公开回调 URL，支持签名校验、请求日志记录、防重复处理。
- 通知与监控：基础告警钩子（异常状态、长时间未更新），操作日志与审计（最小 MVP 可存储 webhook 日志）。

## 成功衡量
- 轨迹状态更新及时率：90% Webhook 在 2 分钟内入库。
- 同步失败率：<1%，重试后成功率 >99%。
- 前端列表分页查询 P95 响应 < 800ms（含缓存）。

## 依赖
- 17TRACK API/Webhook、MySQL、Redis、消息队列（如 RabbitMQ/Kafka/RocketMQ）、Vue3+Vite 前端、Java + Spring Boot + MyBatis 后端。

## 里程碑（MVP）
1. 数据模型与接口打通（店铺/运单/轨迹）。
2. Webhook 接入 + 拉取同步任务。
3. 前端列表 + 详情时间线 + CSV 导入界面。
4. 缓存与重试机制上线。
