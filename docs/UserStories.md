# 用户故事与验收标准

## 登录与权限
- **作为管理员**，我可以通过账号密码登录后台，只有登录后才能访问运单与店铺配置。
  - 验收：错误密码有提示；登录成功返回 Token；未登录访问受保护页面被重定向到登录页；支持退出登录。

## 店铺管理
- **作为运营人员**，我可以创建并配置 Shopify/Shopline/TikTok 店铺凭证，以便系统能从对应店铺同步订单。
  - 验收：支持填写店铺名称、平台类型、API Key/Secret/Token；创建后可编辑；缺失必填项时提示错误。
  - 验收：更新凭证时敏感字段脱敏显示，保存后可「测试连接」验证有效性并展示结果。

## 运单导入
- **作为运营人员**，我可以上传符合模板的 CSV 批量导入追踪单号，导入任务异步执行，导入结果有成功/失败行反馈。
  - 验收：导入时校验必填字段（店铺、单号、承运商代码）；错误行展示原因；导入成功后列表可查。
- **作为运营人员**，我可以手动单独添加运单并指定来源（手动/Shopify/API），便于快速补录。
  - 验收：提交后生成 tracking 记录，状态初始为“待同步/InfoReceived”。
- **作为运营人员**，我可以批量删除选中的运单记录，以移除无效数据。
  - 验收：删除动作需二次确认；删除后关联轨迹不再展示。

## 列表与筛选
- **作为客服人员**，我可以在后台按店铺、状态、时间范围搜索运单并分页浏览，快速定位需要的订单。
  - 验收：支持模糊查询 tracking number；支持按最近更新时间排序；分页可配置 page/size。

## 运单详情与轨迹
- **作为客服人员**，我可以在详情页查看运单基础信息、当前状态、承运商信息与轨迹时间线，以便回复客户。
  - 验收：轨迹按时间倒序展示；显示事件时间、地点、描述、阶段(stage)。

## 同步与Webhook
- **作为系统**，我会根据 next_sync_at 主动拉取 17TRACK 状态，并消费 Webhook 推送，保持轨迹数据最新。
  - 验收：Webhook 收到后入库日志，若签名/重复则拒绝；更新 tracking 状态与轨迹；失败会记录 sync_jobs 并重试。

## 监控与告警
- **作为运营人员**，我可以在后台查看同步任务的成功/失败列表，并了解失败原因以便人工干预。
  - 验收：sync_jobs 展示状态、错误信息、开始/结束时间；支持按 tracking_id 筛选。
